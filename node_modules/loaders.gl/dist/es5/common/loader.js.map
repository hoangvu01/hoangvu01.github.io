{"version":3,"sources":["../../../src/common/loader.js"],"names":["loadFile","url","loader","options","parseBinary","loadBinary","then","data","parseText","text","Promise","reject","Error","name","request","promise","resolve","XMLHttpRequest","open","responseType","onload","status","response","onerror","error","send","abort","bind"],"mappings":";;;;;;;;AAAA;;AAEO,SAASA,QAAT,CAAkBC,GAAlB,EAAuBC,MAAvB,EAA6C;AAAA,MAAdC,OAAc,uEAAJ,EAAI;;AAClD,MAAID,MAAM,CAACE,WAAX,EAAwB;AACtB,WAAOC,UAAU,CAACJ,GAAD,CAAV,CAAgBK,IAAhB,CAAqB,UAAAC,IAAI;AAAA,aAAIL,MAAM,CAACE,WAAP,CAAmBG,IAAnB,EAAyBJ,OAAzB,CAAJ;AAAA,KAAzB,CAAP;AACD;;AACD,MAAID,MAAM,CAACM,SAAX,EAAsB;AACpB,WAAO,wBAAUP,GAAV,EAAeK,IAAf,CAAoB,UAAAG,IAAI;AAAA,aAAIP,MAAM,CAACM,SAAP,CAAiBC,IAAjB,EAAuBN,OAAvB,CAAJ;AAAA,KAAxB,CAAP;AACD;;AACD,SAAOO,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,0BAA4BX,GAA5B,oBAAyCC,MAAM,CAACW,IAAhD,aAAf,CAAP;AACD;AAED;;;;;;AAKA;;;AACO,SAASR,UAAT,CAAoBJ,GAApB,EAAyB;AAC9B,MAAIa,OAAO,GAAG,IAAd;AACA,MAAMC,OAAO,GAAG,IAAIL,OAAJ,CAAY,UAACM,OAAD,EAAUL,MAAV,EAAqB;AAC/CG,IAAAA,OAAO,GAAG,IAAIG,cAAJ,EAAV;;AACA,QAAI;AACFH,MAAAA,OAAO,CAACI,IAAR,CAAa,KAAb,EAAoBjB,GAApB,EAAyB,IAAzB;AACAa,MAAAA,OAAO,CAACK,YAAR,GAAuB,aAAvB;;AAEAL,MAAAA,OAAO,CAACM,MAAR,GAAiB,YAAM;AACrB,YAAIN,OAAO,CAACO,MAAR,KAAmB,GAAvB,EAA4B;AAC1BL,UAAAA,OAAO,CAACF,OAAO,CAACQ,QAAT,CAAP;AACD;;AACDX,QAAAA,MAAM,CAAC,IAAIC,KAAJ,CAAU,2BAAV,CAAD,CAAN;AACD,OALD;;AAMAE,MAAAA,OAAO,CAACS,OAAR,GAAkB,UAAAC,KAAK;AAAA,eAAIb,MAAM,CAACa,KAAD,CAAV;AAAA,OAAvB;;AAEAV,MAAAA,OAAO,CAACW,IAAR;AACD,KAbD,CAaE,OAAOD,KAAP,EAAc;AACdb,MAAAA,MAAM,CAACa,KAAD,CAAN;AACD;AACF,GAlBe,CAAhB,CAF8B,CAqB9B;;AACAT,EAAAA,OAAO,CAACW,KAAR,GAAgBZ,OAAO,CAACY,KAAR,CAAcC,IAAd,CAAmBb,OAAnB,CAAhB;AACA,SAAOC,OAAP;AACD","sourcesContent":["import {request as d3request} from 'd3-request';\n\nexport function loadFile(url, loader, options = {}) {\n  if (loader.parseBinary) {\n    return loadBinary(url).then(data => loader.parseBinary(data, options));\n  }\n  if (loader.parseText) {\n    return d3request(url).then(text => loader.parseText(text, options));\n  }\n  return Promise.reject(new Error(`Could not load ${url} using ${loader.name} loader`));\n}\n\n/**\n * loads binary data\n * @param {string} url\n * @return {Promise} promise that resolves to the binary data\n */\n/* global XMLHttpRequest */\nexport function loadBinary(url) {\n  let request = null;\n  const promise = new Promise((resolve, reject) => {\n    request = new XMLHttpRequest();\n    try {\n      request.open('GET', url, true);\n      request.responseType = 'arraybuffer';\n\n      request.onload = () => {\n        if (request.status === 200) {\n          resolve(request.response);\n        }\n        reject(new Error('Could not get binary data'));\n      };\n      request.onerror = error => reject(error);\n\n      request.send();\n    } catch (error) {\n      reject(error);\n    }\n  });\n  // Make abort() available\n  promise.abort = request.abort.bind(request);\n  return promise;\n}\n"],"file":"loader.js"}