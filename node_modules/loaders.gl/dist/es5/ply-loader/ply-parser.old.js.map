{"version":3,"sources":["../../../src/ply-loader/ply-parser.old.js"],"names":["isLittleEndian","Uint32Array","Uint8Array","buffer","PARSER_STATE","BEGIN","FORMAT","HEADER","BODY","DONE","ERROR","PLY_FORMAT","ASCII","BINARY_LITTLE_ENDIAN","BINARY_BIG_ENDIAN","UNKNOWN","PLY_TYPES","INT","FLOAT","LIST","LIST_INT","LIST_FLOAT","PLY_TYPENAMES","char","Int8Array","int8","uchar","uint8","short","Int16Array","int16","ushort","Uint16Array","uint16","int","Int32Array","int32","uint","uint32","float","Float32Array","float32","double","Float64Array","float64","SYSTEM_ENDIAN","PLYProperty","name","data","type","size0","size1","PLYElement","count","properties","data_buffer","float_view","double_view","TRAIL_EOL","Buffer","PLYParser","onsuccess","onerror","state","format","elements","offset","buffers","current_element","current_index","current_line","current_property","current_list_property","last_line","max_len","ptr","cbuf","n","prefix","length","push","slice","splice","join","toString","shift","console","log","v","len","i","getchar","Number","NaN","r","j","t","message","Error","clearBuffers","result","element","props","prop","c","idx","p","vi","getint","isNaN","raiseError","vf","getfloat","lst","Array","l","getline","toks","split","c_tok","parseInt","parseFloat","sz","t0","t1","typecons","processProperty","processAscii","processBinary","processToken","ondata","createResult","onend"],"mappings":"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","sourcesContent":["/*\n  Modified from Mikola Lysenko's parse-ply\n  MIT License\n*/\n/* eslint-disable */\nconst isLittleEndian = new Uint32Array(new Uint8Array([1, 2, 3, 4]).buffer)[0] === 0x04030201;\n\nconst PARSER_STATE = {\n  BEGIN: 0,\n  FORMAT: 1,\n  HEADER: 2,\n  BODY: 4,\n  DONE: 5,\n  ERROR: -1\n};\n\nconst PLY_FORMAT = {\n  ASCII: 0,\n  BINARY_LITTLE_ENDIAN: 1,\n  BINARY_BIG_ENDIAN: 2,\n  UNKNOWN: -1\n};\n\nconst PLY_TYPES = {\n  INT: 0,\n  FLOAT: 1,\n  LIST: 2,\n  LIST_INT: 2,\n  LIST_FLOAT: 3\n};\n\nconst PLY_TYPENAMES = {\n  char: [PLY_TYPES.INT, 1, Int8Array],\n  int8: [PLY_TYPES.INT, 1, Int8Array],\n  uchar: [PLY_TYPES.INT, 1, Uint8Array],\n  uint8: [PLY_TYPES.INT, 1, Uint8Array],\n  short: [PLY_TYPES.INT, 2, Int16Array],\n  int16: [PLY_TYPES.INT, 2, Int16Array],\n  ushort: [PLY_TYPES.INT, 2, Uint16Array],\n  uint16: [PLY_TYPES.INT, 2, Uint16Array],\n  int: [PLY_TYPES.INT, 4, Int32Array],\n  int32: [PLY_TYPES.INT, 4, Int32Array],\n  uint: [PLY_TYPES.INT, 4, Uint32Array],\n  uint32: [PLY_TYPES.INT, 4, Uint32Array],\n  float: [PLY_TYPES.FLOAT, 4, Float32Array],\n  float32: [PLY_TYPES.FLOAT, 4, Float32Array],\n  double: [PLY_TYPES.FLOAT, 8, Float64Array],\n  float64: [PLY_TYPES.FLOAT, 8, Float64Array]\n};\n\nconst SYSTEM_ENDIAN = isLittleEndian\n  ? PLY_FORMAT.BINARY_LITTLE_ENDIAN\n  : PLY_FORMAT.BINARY_BIG_ENDIAN;\n\nclass PLYProperty {\n  constructor(name, data, type, size0, size1) {\n    this.name = name;\n    this.data = data;\n    this.type = type;\n    this.size0 = size0;\n    this.size1 = size1;\n  }\n}\n\nclass PLYElement {\n  constructor(name, count) {\n    this.name = name;\n    this.count = count;\n    this.properties = [];\n  }\n}\n\nconst data_buffer = new Uint8Array(8);\nconst float_view = new Float32Array(data_buffer.buffer);\nconst double_view = new Float64Array(data_buffer.buffer);\n\nconst TRAIL_EOL = new Buffer(1);\nTRAIL_EOL[0] = 10;\n\nexport default class PLYParser {\n  constructor() {\n    this.onsuccess = () => {};\n    this.onerror = () => {};\n    this.state = PARSER_STATE.BEGIN;\n    this.format = PLY_FORMAT.UNKNOWN;\n    this.elements = [];\n    this.offset = 0;\n    this.buffers = [];\n    this.current_element = 0;\n    this.current_index = 0;\n    this.current_line = 0;\n    this.current_property = 0;\n    this.current_list_property = -1;\n    this.last_line = '';\n  }\n\n  getline(max_len) {\n    var ptr = this.offset;\n    var cbuf = 0;\n    var n = 0;\n    var prefix = null;\n    while (n < max_len && cbuf < this.buffers.length) {\n      if (this.buffers[cbuf][ptr] === 10) {\n        this.current_line++;\n        if (cbuf > 0) {\n          prefix.push(this.buffers[cbuf].slice(0, ptr));\n          this.offset = ptr + 1;\n          if (this.offset >= this.buffers[cbuf].length) {\n            this.offset = 0;\n            this.buffers.splice(0, cbuf + 1);\n          } else {\n            this.buffers.splice(0, cbuf);\n          }\n          this.last_line = prefix.join('');\n          return this.last_line;\n        } else {\n          this.last_line = this.buffers[0].slice(this.offset, ptr).toString();\n          this.offset = ptr + 1;\n          if (this.offset >= this.buffers[cbuf].length) {\n            this.offset = 0;\n            this.buffers.shift();\n          }\n          return this.last_line;\n        }\n      }\n      if (++ptr >= this.buffers[cbuf].length) {\n        if (cbuf === 0) {\n          prefix = [this.buffers[0].slice(this.offset)];\n        }\n        ++n;\n        ++cbuf;\n        ptr = 0;\n      }\n    }\n    console.log(this.offset);\n    if (n >= max_len) {\n      return '!';\n    }\n    return null;\n  }\n\n  getchar() {\n    if (this.buffers.length > 0) {\n      var v = this.buffers[0][this.offset];\n      this.offset++;\n      if (this.offset > this.buffers[0].length) {\n        this.offset = 0;\n        this.buffers.shift();\n      }\n      return v;\n    }\n    return -1;\n  }\n\n  getint(len) {\n    for (var i = 0; i < len; ++i) {\n      var v = this.getchar();\n      if (v < 0) {\n        return Number.NaN;\n      }\n      data_buffer[i] = v;\n    }\n    var r = 0;\n    if (this.format === PLY_FORMAT.BINARY_LITTLE_ENDIAN) {\n      for (var j = 0; j < len; ++j) {\n        r += data_buffer[j] << (8 * j);\n      }\n    } else {\n      for (var j = 0; j < len; ++j) {\n        r += data_buffer[len - j - 1] << (8 * j);\n      }\n    }\n    return r;\n  }\n\n  getfloat(len) {\n    for (var i = 0; i < len; ++i) {\n      var v = this.getchar();\n      if (v < 0) {\n        return Number.NaN;\n      }\n      data_buffer[i] = v;\n    }\n    if (this.format !== SYSTEM_ENDIAN) {\n      for (var i = 0; i < len; ++i) {\n        var t = data_buffer[i];\n        data_buffer[i] = data_buffer[len - i - 1];\n        data_buffer[len - i - 1] = t;\n      }\n    }\n    if (len === 4) {\n      return float_view[0];\n    } else {\n      return double_view[0];\n    }\n  }\n\n  clearBuffers() {\n    this.offset = 0;\n    this.buffers = [];\n  }\n\n  raiseError(message) {\n    if (this.state !== PARSER_STATE.ERROR) {\n      this.state = PARSER_STATE.ERROR;\n      if (this.current_line > 0) {\n        this.onerror(\n          new Error(\n            'Error parsing PLY: ' +\n              message +\n              ' on line ' +\n              this.current_line +\n              \"\\n\\t'\" +\n              this.last_line +\n              \"'\"\n          )\n        );\n      } else {\n        this.onerror(new Error('Error parsing PLY: ' + message));\n      }\n      this.clearBuffers();\n    }\n  }\n\n  createResult() {\n    var result = {};\n    for (var i = 0; i < this.elements.length; ++i) {\n      var element = this.elements[i];\n      var props = {};\n      for (var j = 0; j < element.properties.length; ++j) {\n        var prop = element.properties[j];\n        props[prop.name] = prop.data;\n      }\n      result[element.name] = props;\n    }\n    return result;\n  }\n\n  processBinary() {\n    while (this.current_element < this.elements.length) {\n      var c = this.elements[this.current_element];\n      var props = c.properties;\n      while (this.current_index < c.count) {\n        var idx = this.current_index;\n        while (this.current_property < props.length) {\n          var p = props[this.current_property++];\n          switch (p.type) {\n            case PLY_TYPES.INT:\n              var vi = this.getint(p.size0);\n              if (isNaN(vi)) {\n                this.raiseError('Invalid integer value');\n                return false;\n              }\n              p.data[idx] = vi;\n              break;\n\n            case PLY_TYPES.FLOAT:\n              var vf = this.getfloat(p.size0);\n              if (isNaN(vf)) {\n                this.raiseError('Invalid float value');\n                return false;\n              }\n              p.data[idx] = vf;\n              break;\n\n            case PLY_TYPES.LIST_INT:\n            case PLY_TYPES.LIST_FLOAT:\n              var lst;\n              if (this.current_list_property < 0) {\n                var vi = this.getint(p.size0);\n                if (isNaN(vi)) {\n                  this.raiseError('Invalid list length');\n                  return false;\n                }\n                lst = new Array(vi);\n                p.data[idx] = lst;\n                this.current_list_property = 0;\n              } else {\n                lst = p.data[idx];\n              }\n              while (this.current_list_property < lst.length) {\n                var v;\n                if (p.type === PLY_TYPES.LIST_INT) {\n                  v = this.getint(p.size1);\n                } else {\n                  v = this.getfloat(p.size1);\n                }\n                if (isNaN(v)) {\n                  this.raiseError('Invalid value in list');\n                  return false;\n                }\n                lst[this.current_list_property++] = v;\n              }\n              this.current_list_property = -1;\n              break;\n\n            default:\n              this.raiseError('Uninitialized property type (this should never happen)');\n              return false;\n          }\n        }\n\n        this.current_property = 0;\n        this.current_index += 1;\n      }\n      this.current_index = 0;\n      this.current_element++;\n    }\n    this.state = PARSER_STATE.DONE;\n    return true;\n  }\n\n  processAscii() {\n    while (this.current_element < this.elements.length) {\n      var c = this.elements[this.current_element];\n      var props = c.properties;\n      while (this.current_index < c.count) {\n        var l = this.getline(1 << 20);\n        if (!l) {\n          return false;\n        }\n        var idx = this.current_index;\n        var toks = l.split(' ');\n        var c_tok = 0;\n        for (var i = 0; i < props.length; ++i) {\n          if (c_tok >= toks.length) {\n            this.raiseError('Not enough values for element');\n            return false;\n          }\n          var p = props[i];\n          switch (p.type) {\n            case PLY_TYPES.INT:\n              var vi = parseInt(toks[c_tok++], 10);\n              if (isNaN(vi)) {\n                this.raiseError('Invalid integer value');\n                return false;\n              }\n              p.data[idx] = vi;\n              break;\n\n            case PLY_TYPES.FLOAT:\n              var vf = parseFloat(toks[c_tok++]);\n              if (isNaN(vf)) {\n                this.raiseError('Invalid float value');\n                return false;\n              }\n              p.data[idx] = vf;\n              break;\n\n            case PLY_TYPES.LIST_INT:\n            case PLY_TYPES.LIST_FLOAT:\n              var vi = parseInt(toks[c_tok++]);\n              if (isNaN(vi) || vi < 0) {\n                this.raiseError('Invalid list length');\n                return false;\n              }\n              if (vi + c_tok > toks.length) {\n                this.raiseError('List length too long');\n                return false;\n              }\n              var result = new Array(vi);\n              p.data[idx] = result;\n              if (p.type === PLY_TYPES.LIST_INT) {\n                for (var j = 0; j < vi; ++j) {\n                  result[j] = parseInt(toks[c_tok++], 10);\n                  if (isNaN(result[j])) {\n                    this.raiseError('Invalid integer in list');\n                    return false;\n                  }\n                }\n              } else {\n                for (var j = 0; j < vi; ++j) {\n                  result[j] = parseFloat(toks[c_tok++]);\n                  if (isNaN(result[j])) {\n                    this.raiseError('Invalid float in list');\n                    return false;\n                  }\n                }\n              }\n              break;\n\n            default:\n              this.raiseError('Uninitialized property type (this should never happen)');\n              return false;\n          }\n        }\n        this.current_index += 1;\n      }\n      this.current_index = 0;\n      this.current_element++;\n    }\n    this.state = PARSER_STATE.DONE;\n    return true;\n  }\n\n  processProperty(name, type) {\n    var sz = this.elements[this.elements.length - 1].count;\n    if (type[0] === 'list') {\n      if (type.length !== 3) {\n        this.raiseError('Invalid list datatype');\n        return null;\n      }\n      var t0 = PLY_TYPENAMES[type[1]];\n      var t1 = PLY_TYPENAMES[type[2]];\n      if (!t0 || t0[0] !== PLY_TYPES.INT) {\n        this.raiseError('List length must be an integer');\n        return null;\n      }\n      if (!t1) {\n        this.raiseError('Invalid type for list values');\n        return null;\n      }\n      return new PLYProperty(name, new Array(sz), t1[0] + PLY_TYPES.LIST, t0[1], t1[1]);\n    }\n    var t = PLY_TYPENAMES[type[0]];\n    if (!t) {\n      this.raiseError('Invalid property datatype');\n      return null;\n    }\n    var typecons = t[2];\n    return new PLYProperty(name, new typecons(sz), t[0], t[1], 0);\n  }\n\n  processToken() {\n    switch (this.state) {\n      case PARSER_STATE.BEGIN:\n        var l = this.getline(4);\n        if (!l) {\n          return false;\n        }\n        if (l === 'ply') {\n          this.state = PARSER_STATE.FORMAT;\n          return true;\n        } else {\n          this.raiseError('Missing/invalid PLY magic number');\n          return false;\n        }\n        break;\n\n      case PARSER_STATE.FORMAT:\n        var l = this.getline(64);\n        if (!l) {\n          return false;\n        }\n        var toks = l.split(' ');\n        if (toks.length > 0 && toks[0] === 'comment') {\n          return true;\n        }\n        if (toks.length !== 3 || toks[0] !== 'format' || toks[2] !== '1.0') {\n          this.raiseError('Missing/invalid format specifier');\n          return false;\n        }\n        switch (toks[1]) {\n          case 'ascii':\n            this.format = PLY_FORMAT.ASCII;\n            break;\n\n          case 'binary_little_endian':\n            this.format = PLY_FORMAT.BINARY_LITTLE_ENDIAN;\n            break;\n\n          case 'binary_big_endian':\n            this.format = PLY_FORMAT.BINARY_BIG_ENDIAN;\n            break;\n\n          default:\n            this.raiseError('Invalid format');\n            return false;\n            break;\n        }\n        this.state = PARSER_STATE.HEADER;\n        return true;\n        break;\n\n      case PARSER_STATE.HEADER:\n        var l = this.getline(4096);\n        if (!l) {\n          return false;\n        }\n        var toks = l.split(' ');\n        switch (toks[0]) {\n          case 'element':\n            if (toks.length !== 3) {\n              this.raiseError('Invalid element description');\n              return false;\n            }\n            var count = parseInt(toks[2], 10);\n            if (isNaN(count) || count < 0) {\n              this.raiseError('Invalid element count');\n              return false;\n            }\n            this.elements.push(new PLYElement(toks[1], count));\n            return true;\n            break;\n\n          case 'property':\n            if (this.elements.length === 0) {\n              this.raiseError('Got a property without an element');\n              return false;\n            }\n            if (toks.length < 3) {\n              this.raiseError('Invalid property description');\n              return false;\n            }\n            var prop = this.processProperty(toks[toks.length - 1], toks.slice(1, toks.length - 1));\n            if (!prop) {\n              return false;\n            }\n            this.elements[this.elements.length - 1].properties.push(prop);\n            return true;\n            break;\n\n          case 'end_header':\n            this.current_index = 0;\n            this.current_element = 0;\n            this.state = PARSER_STATE.BODY;\n            if (this.format !== PLY_FORMAT.ASCII) {\n              this.current_line = -1;\n            }\n            return true;\n            break;\n\n          case 'comment':\n            return true;\n            break;\n\n          default:\n            this.raiseError('Unexpeceted token in header');\n            return false;\n        }\n        break;\n\n      case PARSER_STATE.BODY:\n        switch (this.format) {\n          case PLY_FORMAT.ASCII:\n            return this.processAscii();\n          case PLY_FORMAT.BINARY_LITTLE_ENDIAN:\n          case PLY_FORMAT.BINARY_BIG_ENDIAN:\n            return this.processBinary();\n          default:\n            this.raiseError('Invalid format, this should not happen');\n            return false;\n        }\n        break;\n\n      case PARSER_STATE.DONE:\n        this.clearBuffers();\n        return false;\n        break;\n\n      case PARSER_STATE.ERROR:\n        this.clearBuffers();\n        return false;\n        break;\n\n      default:\n        this.raiseError('Parser state corrupted');\n        return false;\n    }\n    return false;\n  }\n\n  ondata(data) {\n    if (this.state === PARSER_STATE.ERROR) {\n      return;\n    }\n    if (data instanceof Buffer) {\n      this.buffers.push(data);\n    } else {\n      this.buffers.push(new Buffer(data));\n    }\n    while (this.processToken()) {}\n  }\n\n  onend() {\n    this.ondata(TRAIL_EOL);\n    this.clearBuffers();\n    if (this.state === PARSER_STATE.DONE) {\n      this.onsuccess(this.createResult());\n    } else if (this.state !== PARSER_STATE.ERROR) {\n      this.raiseError('Unexpected EOF while parsing PLY file');\n    }\n  }\n\n  parse(buffer) {\n    this.ondata(buffer);\n    this.onend();\n  }\n}\n"],"file":"ply-parser.old.js"}