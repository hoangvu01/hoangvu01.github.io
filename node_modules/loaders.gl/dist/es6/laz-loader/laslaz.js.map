{"version":3,"sources":["../../../src/laz-loader/laslaz.js"],"names":["scope","pointFormatReaders","dv","position","getInt32","intensity","getUint16","classification","getUint8","color","readAs","buf","Type","offset","count","undefined","sub","slice","BYTES_PER_ELEMENT","r","ret","i","push","parseLASHeader","arraybuffer","o","pointsOffset","Uint32Array","pointsFormatId","Uint8Array","pointsStructSize","Uint16Array","pointsCount","start","scale","Float64Array","bounds","maxs","mins","msgIndex","waitHandlers","handleMessage","message_event","msg","data","resolver","id","setTimeout","error","reject","Error","message","hasOwnProperty","resolve","buffer","result","hasMoreData","doDataExchange","cmd","callback","toString","Promise","defer","nacl_module","postMessage","promise","cancellable","LASLoader","prototype","open","readOffset","res","rej","getHeader","header","readData","skip","Math","min","end","pointsToRead","bufferSize","ceil","pointsRead","src","set","close","LAZLoader","ww","Worker","nextCB","onmessage","e","dorr","req","cb","type","status","LASFile","determineVersion","version","determineFormat","formatId","loader","isCompressed","bit_7","bit_6","ver","Int8Array","versionAsString","LASDecoder","len","arrayb","decoder","pointSize","getPoint","index","DataView","getUnpacker","LASModuleWasLoaded","module","exports"],"mappings":"AAAA;;;;;AAMA;;AACA;AAEA,CAAC,UAASA,KAAT,EAAgB;AACf;;AAEA,MAAIC,kBAAkB,GAAG;AACvB,OAAG,WAASC,EAAT,EAAa;AACd,aAAO;AACLC,QAAAA,QAAQ,EAAE,CAACD,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAD,EAAuBF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAvB,EAA6CF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAA7C,CADL;AAELC,QAAAA,SAAS,EAAEH,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAFN;AAGLC,QAAAA,cAAc,EAAEL,EAAE,CAACM,QAAH,CAAY,EAAZ,EAAgB,IAAhB;AAHX,OAAP;AAKD,KAPsB;AAQvB,OAAG,WAASN,EAAT,EAAa;AACd,aAAO;AACLC,QAAAA,QAAQ,EAAE,CAACD,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAD,EAAuBF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAvB,EAA6CF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAA7C,CADL;AAELC,QAAAA,SAAS,EAAEH,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAFN;AAGLC,QAAAA,cAAc,EAAEL,EAAE,CAACM,QAAH,CAAY,EAAZ,EAAgB,IAAhB;AAHX,OAAP;AAKD,KAdsB;AAevB,OAAG,WAASN,EAAT,EAAa;AACd,aAAO;AACLC,QAAAA,QAAQ,EAAE,CAACD,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAD,EAAuBF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAvB,EAA6CF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAA7C,CADL;AAELC,QAAAA,SAAS,EAAEH,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAFN;AAGLC,QAAAA,cAAc,EAAEL,EAAE,CAACM,QAAH,CAAY,EAAZ,EAAgB,IAAhB,CAHX;AAILC,QAAAA,KAAK,EAAE,CAACP,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAAD,EAAyBJ,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAAzB,EAAiDJ,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAAjD;AAJF,OAAP;AAMD,KAtBsB;AAuBvB,OAAG,WAASJ,EAAT,EAAa;AACd,aAAO;AACLC,QAAAA,QAAQ,EAAE,CAACD,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAD,EAAuBF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAAvB,EAA6CF,EAAE,CAACE,QAAH,CAAY,CAAZ,EAAe,IAAf,CAA7C,CADL;AAELC,QAAAA,SAAS,EAAEH,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAFN;AAGLC,QAAAA,cAAc,EAAEL,EAAE,CAACM,QAAH,CAAY,EAAZ,EAAgB,IAAhB,CAHX;AAILC,QAAAA,KAAK,EAAE,CAACP,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAAD,EAAyBJ,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAAzB,EAAiDJ,EAAE,CAACI,SAAH,CAAa,EAAb,EAAiB,IAAjB,CAAjD;AAJF,OAAP;AAMD;AA9BsB,GAAzB;;AAiCA,WAASI,MAAT,CAAgBC,GAAhB,EAAqBC,IAArB,EAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AACxCA,IAAAA,KAAK,GAAGA,KAAK,KAAKC,SAAV,IAAuBD,KAAK,KAAK,CAAjC,GAAqC,CAArC,GAAyCA,KAAjD;AACA,QAAIE,GAAG,GAAGL,GAAG,CAACM,KAAJ,CAAUJ,MAAV,EAAkBA,MAAM,GAAGD,IAAI,CAACM,iBAAL,GAAyBJ,KAApD,CAAV;AAEA,QAAIK,CAAC,GAAG,IAAIP,IAAJ,CAASI,GAAT,CAAR;AACA,QAAIF,KAAK,KAAK,CAAd,EAAiB,OAAOK,CAAC,CAAC,CAAD,CAAR;AAEjB,QAAIC,GAAG,GAAG,EAAV;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,KAApB,EAA2BO,CAAC,EAA5B,EAAgC;AAC9BD,MAAAA,GAAG,CAACE,IAAJ,CAASH,CAAC,CAACE,CAAD,CAAV;AACD;;AAED,WAAOD,GAAP;AACD;;AAED,WAASG,cAAT,CAAwBC,WAAxB,EAAqC;AACnC,QAAIC,CAAC,GAAG,EAAR;AAEAA,IAAAA,CAAC,CAACC,YAAF,GAAiBhB,MAAM,CAACc,WAAD,EAAcG,WAAd,EAA2B,KAAK,CAAhC,CAAvB;AACAF,IAAAA,CAAC,CAACG,cAAF,GAAmBlB,MAAM,CAACc,WAAD,EAAcK,UAAd,EAA0B,KAAK,CAAL,GAAS,CAAnC,CAAzB;AACAJ,IAAAA,CAAC,CAACK,gBAAF,GAAqBpB,MAAM,CAACc,WAAD,EAAcO,WAAd,EAA2B,KAAK,CAAL,GAAS,CAAT,GAAa,CAAxC,CAA3B;AACAN,IAAAA,CAAC,CAACO,WAAF,GAAgBtB,MAAM,CAACc,WAAD,EAAcG,WAAd,EAA2B,KAAK,CAAL,GAAS,EAApC,CAAtB;AAEA,QAAIM,KAAK,GAAG,KAAK,CAAL,GAAS,EAArB;AACAR,IAAAA,CAAC,CAACS,KAAF,GAAUxB,MAAM,CAACc,WAAD,EAAcW,YAAd,EAA4BF,KAA5B,EAAmC,CAAnC,CAAhB;AACAA,IAAAA,KAAK,IAAI,EAAT,CAVmC,CAUtB;;AACbR,IAAAA,CAAC,CAACZ,MAAF,GAAWH,MAAM,CAACc,WAAD,EAAcW,YAAd,EAA4BF,KAA5B,EAAmC,CAAnC,CAAjB;AACAA,IAAAA,KAAK,IAAI,EAAT;AAEA,QAAIG,MAAM,GAAG1B,MAAM,CAACc,WAAD,EAAcW,YAAd,EAA4BF,KAA5B,EAAmC,CAAnC,CAAnB;AACAA,IAAAA,KAAK,IAAI,EAAT,CAfmC,CAetB;;AACbR,IAAAA,CAAC,CAACY,IAAF,GAAS,CAACD,MAAM,CAAC,CAAD,CAAP,EAAYA,MAAM,CAAC,CAAD,CAAlB,EAAuBA,MAAM,CAAC,CAAD,CAA7B,CAAT;AACAX,IAAAA,CAAC,CAACa,IAAF,GAAS,CAACF,MAAM,CAAC,CAAD,CAAP,EAAYA,MAAM,CAAC,CAAD,CAAlB,EAAuBA,MAAM,CAAC,CAAD,CAA7B,CAAT;AAEA,WAAOX,CAAP;AACD;;AAED,MAAIc,QAAQ,GAAG,CAAf;AACA,MAAIC,YAAY,GAAG,EAAnB,CA1Ee,CA4Ef;AACA;;AACAxC,EAAAA,KAAK,CAACyC,aAAN,GAAsB,UAASC,aAAT,EAAwB;AAC5C,QAAIC,GAAG,GAAGD,aAAa,CAACE,IAAxB;AACA,QAAIC,QAAQ,GAAGL,YAAY,CAACG,GAAG,CAACG,EAAL,CAA3B;AACA,WAAON,YAAY,CAACG,GAAG,CAACG,EAAL,CAAnB,CAH4C,CAK5C;AACA;;AACAC,IAAAA,UAAU,CAAC,YAAW;AACpB,UAAIJ,GAAG,CAACK,KAAR,EAAe,OAAOH,QAAQ,CAACI,MAAT,CAAgB,IAAIC,KAAJ,CAAUP,GAAG,CAACQ,OAAJ,IAAe,eAAzB,CAAhB,CAAP;;AAEf,UAAIR,GAAG,CAACS,cAAJ,CAAmB,OAAnB,KAA+BT,GAAG,CAACS,cAAJ,CAAmB,aAAnB,CAAnC,EAAsE;AACpE,eAAOP,QAAQ,CAACQ,OAAT,CAAiB;AACtBC,UAAAA,MAAM,EAAEX,GAAG,CAACY,MADU;AAEtBzC,UAAAA,KAAK,EAAE6B,GAAG,CAAC7B,KAFW;AAGtB0C,UAAAA,WAAW,EAAEb,GAAG,CAACa;AAHK,SAAjB,CAAP;AAKD;;AAEDX,MAAAA,QAAQ,CAACQ,OAAT,CAAiBV,GAAG,CAACY,MAArB;AACD,KAZS,EAYP,CAZO,CAAV;AAaD,GApBD;;AAsBA,MAAIE,cAAc,GAAG,SAAjBA,cAAiB,CAASC,GAAT,EAAcC,QAAd,EAAwB;AAC3CD,IAAAA,GAAG,CAACZ,EAAJ,GAASP,QAAQ,CAACqB,QAAT,EAAT;AACArB,IAAAA,QAAQ;AAER,QAAIM,QAAQ,GAAGgB,OAAO,CAACC,KAAR,EAAf;AACAtB,IAAAA,YAAY,CAACkB,GAAG,CAACZ,EAAL,CAAZ,GAAuBD,QAAvB;AAEAkB,IAAAA,WAAW,CAACC,WAAZ,CAAwBN,GAAxB;AAEA,WAAOb,QAAQ,CAACoB,OAAT,CAAiBC,WAAjB,EAAP;AACD,GAVD,CApGe,CAgHf;AACA;AACA;;;AACA,MAAIC,SAAS,GAAG,SAAZA,SAAY,CAAS3C,WAAT,EAAsB;AACpC,SAAKA,WAAL,GAAmBA,WAAnB;AACD,GAFD;;AAIA2C,EAAAA,SAAS,CAACC,SAAV,CAAoBC,IAApB,GAA2B,YAAW;AACpC;AACA;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACA,WAAO,IAAIT,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpCzB,MAAAA,UAAU,CAACwB,GAAD,EAAM,CAAN,CAAV;AACD,KAFM,CAAP;AAGD,GAPD;;AASAJ,EAAAA,SAAS,CAACC,SAAV,CAAoBK,SAApB,GAAgC,YAAW;AACzC,QAAIhD,CAAC,GAAG,IAAR;AAEA,WAAO,IAAIoC,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpCzB,MAAAA,UAAU,CAAC,YAAW;AACpBtB,QAAAA,CAAC,CAACiD,MAAF,GAAWnD,cAAc,CAACE,CAAC,CAACD,WAAH,CAAzB;AACA+C,QAAAA,GAAG,CAAC9C,CAAC,CAACiD,MAAH,CAAH;AACD,OAHS,EAGP,CAHO,CAAV;AAID,KALM,CAAP;AAMD,GATD;;AAWAP,EAAAA,SAAS,CAACC,SAAV,CAAoBO,QAApB,GAA+B,UAAS7D,KAAT,EAAgBD,MAAhB,EAAwB+D,IAAxB,EAA8B;AAC3D,QAAInD,CAAC,GAAG,IAAR;AAEA,WAAO,IAAIoC,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpCzB,MAAAA,UAAU,CAAC,YAAW;AACpB,YAAI,CAACtB,CAAC,CAACiD,MAAP,EACE,OAAOF,GAAG,CAAC,IAAItB,KAAJ,CAAU,2DAAV,CAAD,CAAV;AAEF,YAAIjB,KAAJ;;AACA,YAAI2C,IAAI,IAAI,CAAZ,EAAe;AACb9D,UAAAA,KAAK,GAAG+D,IAAI,CAACC,GAAL,CAAShE,KAAT,EAAgBW,CAAC,CAACiD,MAAF,CAAS1C,WAAT,GAAuBP,CAAC,CAAC6C,UAAzC,CAAR;AACArC,UAAAA,KAAK,GAAGR,CAAC,CAACiD,MAAF,CAAShD,YAAT,GAAwBD,CAAC,CAAC6C,UAAF,GAAe7C,CAAC,CAACiD,MAAF,CAAS5C,gBAAxD;AACA,cAAIiD,GAAG,GAAG9C,KAAK,GAAGnB,KAAK,GAAGW,CAAC,CAACiD,MAAF,CAAS5C,gBAAnC;AACAyC,UAAAA,GAAG,CAAC;AACFjB,YAAAA,MAAM,EAAE7B,CAAC,CAACD,WAAF,CAAcP,KAAd,CAAoBgB,KAApB,EAA2B8C,GAA3B,CADN;AAEFjE,YAAAA,KAAK,EAAEA,KAFL;AAGF0C,YAAAA,WAAW,EAAE/B,CAAC,CAAC6C,UAAF,GAAexD,KAAf,GAAuBW,CAAC,CAACiD,MAAF,CAAS1C;AAH3C,WAAD,CAAH;AAKAP,UAAAA,CAAC,CAAC6C,UAAF,IAAgBxD,KAAhB;AACD,SAVD,MAUO;AACL,cAAIkE,YAAY,GAAGH,IAAI,CAACC,GAAL,CAAShE,KAAK,GAAG8D,IAAjB,EAAuBnD,CAAC,CAACiD,MAAF,CAAS1C,WAAT,GAAuBP,CAAC,CAAC6C,UAAhD,CAAnB;AACA,cAAIW,UAAU,GAAGJ,IAAI,CAACK,IAAL,CAAUF,YAAY,GAAGJ,IAAzB,CAAjB;AACA,cAAIO,UAAU,GAAG,CAAjB;AAEA,cAAIxE,GAAG,GAAG,IAAIkB,UAAJ,CAAeoD,UAAU,GAAGxD,CAAC,CAACiD,MAAF,CAAS5C,gBAArC,CAAV;;AACA,eAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2D,YAApB,EAAkC3D,CAAC,EAAnC,EAAuC;AACrC,gBAAIA,CAAC,GAAGuD,IAAJ,KAAa,CAAjB,EAAoB;AAClB3C,cAAAA,KAAK,GAAGR,CAAC,CAACiD,MAAF,CAAShD,YAAT,GAAwBD,CAAC,CAAC6C,UAAF,GAAe7C,CAAC,CAACiD,MAAF,CAAS5C,gBAAxD;AACA,kBAAIsD,GAAG,GAAG,IAAIvD,UAAJ,CAAeJ,CAAC,CAACD,WAAjB,EAA8BS,KAA9B,EAAqCR,CAAC,CAACiD,MAAF,CAAS5C,gBAA9C,CAAV;AAEAnB,cAAAA,GAAG,CAAC0E,GAAJ,CAAQD,GAAR,EAAaD,UAAU,GAAG1D,CAAC,CAACiD,MAAF,CAAS5C,gBAAnC;AACAqD,cAAAA,UAAU;AACX;;AAED1D,YAAAA,CAAC,CAAC6C,UAAF;AACD;;AAEDC,UAAAA,GAAG,CAAC;AACFjB,YAAAA,MAAM,EAAE3C,GAAG,CAAC2C,MADV;AAEFxC,YAAAA,KAAK,EAAEqE,UAFL;AAGF3B,YAAAA,WAAW,EAAE/B,CAAC,CAAC6C,UAAF,GAAe7C,CAAC,CAACiD,MAAF,CAAS1C;AAHnC,WAAD,CAAH;AAKD;AACF,OAvCS,EAuCP,CAvCO,CAAV;AAwCD,KAzCM,CAAP;AA0CD,GA7CD;;AA+CAmC,EAAAA,SAAS,CAACC,SAAV,CAAoBkB,KAApB,GAA4B,YAAW;AACrC,QAAI7D,CAAC,GAAG,IAAR;AACA,WAAO,IAAIoC,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpC/C,MAAAA,CAAC,CAACD,WAAF,GAAgB,IAAhB;AACAuB,MAAAA,UAAU,CAACwB,GAAD,EAAM,CAAN,CAAV;AACD,KAHM,CAAP;AAID,GAND,CA1Le,CAkMf;AACA;AACA;;;AACA,MAAIgB,SAAS,GAAG,SAAZA,SAAY,CAAS/D,WAAT,EAAsB;AACpC,SAAKA,WAAL,GAAmBA,WAAnB;AACA,SAAKgE,EAAL,GAAU,IAAIC,MAAJ,CAAY,8BAAZ,CAAV;AAEA,SAAKC,MAAL,GAAc,IAAd;AACA,QAAIjE,CAAC,GAAG,IAAR;;AAEA,SAAK+D,EAAL,CAAQG,SAAR,GAAoB,UAASC,CAAT,EAAY;AAC9B,UAAInE,CAAC,CAACiE,MAAF,KAAa,IAAjB,EAAuB;AACrBjE,QAAAA,CAAC,CAACiE,MAAF,CAASE,CAAC,CAAChD,IAAX;AACAnB,QAAAA,CAAC,CAACiE,MAAF,GAAW,IAAX;AACD;AACF,KALD;;AAOA,SAAKG,IAAL,GAAY,UAASC,GAAT,EAAcC,EAAd,EAAkB;AAC5BtE,MAAAA,CAAC,CAACiE,MAAF,GAAWK,EAAX;AACAtE,MAAAA,CAAC,CAAC+D,EAAF,CAAKxB,WAAL,CAAiB8B,GAAjB;AACD,KAHD;AAID,GAlBD;;AAoBAP,EAAAA,SAAS,CAACnB,SAAV,CAAoBC,IAApB,GAA2B,YAAW;AACpC;AACA;AACA,QAAI5C,CAAC,GAAG,IAAR;AACA,WAAO,IAAIoC,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpC/C,MAAAA,CAAC,CAACoE,IAAF,CAAO;AAACG,QAAAA,IAAI,EAAE,MAAP;AAAexE,QAAAA,WAAW,EAAEC,CAAC,CAACD;AAA9B,OAAP,EAAmD,UAASL,CAAT,EAAY;AAC7D,YAAIA,CAAC,CAAC8E,MAAF,KAAa,CAAjB,EAAoB,OAAOzB,GAAG,CAAC,IAAItB,KAAJ,CAAU,qBAAV,CAAD,CAAV;AAEpBqB,QAAAA,GAAG,CAAC,IAAD,CAAH;AACD,OAJD;AAKD,KANM,CAAP;AAOD,GAXD;;AAaAgB,EAAAA,SAAS,CAACnB,SAAV,CAAoBK,SAApB,GAAgC,YAAW;AACzC,QAAIhD,CAAC,GAAG,IAAR;AAEA,WAAO,IAAIoC,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpC/C,MAAAA,CAAC,CAACoE,IAAF,CAAO;AAACG,QAAAA,IAAI,EAAE;AAAP,OAAP,EAAyB,UAAS7E,CAAT,EAAY;AACnC,YAAIA,CAAC,CAAC8E,MAAF,KAAa,CAAjB,EAAoB,OAAOzB,GAAG,CAAC,IAAItB,KAAJ,CAAU,sBAAV,CAAD,CAAV;AAEpBqB,QAAAA,GAAG,CAACpD,CAAC,CAACuD,MAAH,CAAH;AACD,OAJD;AAKD,KANM,CAAP;AAOD,GAVD;;AAYAa,EAAAA,SAAS,CAACnB,SAAV,CAAoBO,QAApB,GAA+B,UAAS7D,KAAT,EAAgBD,MAAhB,EAAwB+D,IAAxB,EAA8B;AAC3D,QAAInD,CAAC,GAAG,IAAR;AAEA,WAAO,IAAIoC,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpC/C,MAAAA,CAAC,CAACoE,IAAF,CAAO;AAACG,QAAAA,IAAI,EAAE,MAAP;AAAelF,QAAAA,KAAK,EAAEA,KAAtB;AAA6BD,QAAAA,MAAM,EAAEA,MAArC;AAA6C+D,QAAAA,IAAI,EAAEA;AAAnD,OAAP,EAAiE,UAASzD,CAAT,EAAY;AAC3E,YAAIA,CAAC,CAAC8E,MAAF,KAAa,CAAjB,EAAoB,OAAOzB,GAAG,CAAC,IAAItB,KAAJ,CAAU,qBAAV,CAAD,CAAV;AACpBqB,QAAAA,GAAG,CAAC;AACFjB,UAAAA,MAAM,EAAEnC,CAAC,CAACmC,MADR;AAEFxC,UAAAA,KAAK,EAAEK,CAAC,CAACL,KAFP;AAGF0C,UAAAA,WAAW,EAAErC,CAAC,CAACqC;AAHb,SAAD,CAAH;AAKD,OAPD;AAQD,KATM,CAAP;AAUD,GAbD;;AAeA+B,EAAAA,SAAS,CAACnB,SAAV,CAAoBkB,KAApB,GAA4B,YAAW;AACrC,QAAI7D,CAAC,GAAG,IAAR;AAEA,WAAO,IAAIoC,OAAJ,CAAY,UAASU,GAAT,EAAcC,GAAd,EAAmB;AACpC/C,MAAAA,CAAC,CAACoE,IAAF,CAAO;AAACG,QAAAA,IAAI,EAAE;AAAP,OAAP,EAAwB,UAAS7E,CAAT,EAAY;AAClC,YAAIA,CAAC,CAAC8E,MAAF,KAAa,CAAjB,EAAoB,OAAOzB,GAAG,CAAC,IAAItB,KAAJ,CAAU,sBAAV,CAAD,CAAV;AAEpBqB,QAAAA,GAAG,CAAC,IAAD,CAAH;AACD,OAJD;AAKD,KANM,CAAP;AAOD,GAVD,CAjQe,CA6Qf;;;AACA,MAAI2B,OAAO,GAAG,SAAVA,OAAU,CAAS1E,WAAT,EAAsB;AAClC,SAAKA,WAAL,GAAmBA,WAAnB;AAEA,SAAK2E,gBAAL;AACA,QAAI,KAAKC,OAAL,GAAe,EAAnB,EAAuB,MAAM,IAAIlD,KAAJ,CAAU,sDAAV,CAAN;AAEvB,SAAKmD,eAAL;AACA,QAAIpG,kBAAkB,CAAC,KAAKqG,QAAN,CAAlB,KAAsCvF,SAA1C,EACE,MAAM,IAAImC,KAAJ,CAAU,sCAAV,CAAN;AAEF,SAAKqD,MAAL,GAAc,KAAKC,YAAL,GACV,IAAIjB,SAAJ,CAAc,KAAK/D,WAAnB,CADU,GAEV,IAAI2C,SAAJ,CAAc,KAAK3C,WAAnB,CAFJ;AAGD,GAbD;;AAeA0E,EAAAA,OAAO,CAAC9B,SAAR,CAAkBiC,eAAlB,GAAoC,YAAW;AAC7C,QAAIC,QAAQ,GAAG5F,MAAM,CAAC,KAAKc,WAAN,EAAmBK,UAAnB,EAA+B,KAAK,CAAL,GAAS,CAAxC,CAArB;AACA,QAAI4E,KAAK,GAAG,CAACH,QAAQ,GAAG,IAAZ,KAAqB,CAAjC;AACA,QAAII,KAAK,GAAG,CAACJ,QAAQ,GAAG,IAAZ,KAAqB,CAAjC;AAEA,QAAIG,KAAK,KAAK,CAAV,IAAeC,KAAK,KAAK,CAA7B,EAAgC,MAAM,IAAIxD,KAAJ,CAAU,qCAAV,CAAN;AAEhC,SAAKoD,QAAL,GAAgBA,QAAQ,GAAG,IAA3B;AACA,SAAKE,YAAL,GAAoBC,KAAK,KAAK,CAAV,IAAeC,KAAK,KAAK,CAA7C;AACD,GATD;;AAWAR,EAAAA,OAAO,CAAC9B,SAAR,CAAkB+B,gBAAlB,GAAqC,YAAW;AAC9C,QAAIQ,GAAG,GAAG,IAAIC,SAAJ,CAAc,KAAKpF,WAAnB,EAAgC,EAAhC,EAAoC,CAApC,CAAV;AACA,SAAK4E,OAAL,GAAeO,GAAG,CAAC,CAAD,CAAH,GAAS,EAAT,GAAcA,GAAG,CAAC,CAAD,CAAhC;AACA,SAAKE,eAAL,GAAuBF,GAAG,CAAC,CAAD,CAAH,GAAS,GAAT,GAAeA,GAAG,CAAC,CAAD,CAAzC;AACD,GAJD;;AAMAT,EAAAA,OAAO,CAAC9B,SAAR,CAAkBC,IAAlB,GAAyB,YAAW;AAClC,WAAO,KAAKkC,MAAL,CAAYlC,IAAZ,EAAP;AACD,GAFD;;AAIA6B,EAAAA,OAAO,CAAC9B,SAAR,CAAkBK,SAAlB,GAA8B,YAAW;AACvC,WAAO,KAAK8B,MAAL,CAAY9B,SAAZ,EAAP;AACD,GAFD;;AAIAyB,EAAAA,OAAO,CAAC9B,SAAR,CAAkBO,QAAlB,GAA6B,UAAS7D,KAAT,EAAgBmB,KAAhB,EAAuB2C,IAAvB,EAA6B;AACxD,WAAO,KAAK2B,MAAL,CAAY5B,QAAZ,CAAqB7D,KAArB,EAA4BmB,KAA5B,EAAmC2C,IAAnC,CAAP;AACD,GAFD;;AAIAsB,EAAAA,OAAO,CAAC9B,SAAR,CAAkBkB,KAAlB,GAA0B,YAAW;AACnC,WAAO,KAAKiB,MAAL,CAAYjB,KAAZ,EAAP;AACD,GAFD,CA1Te,CA8Tf;AACA;;;AACA,MAAIwB,UAAU,GAAG,SAAbA,UAAa,CAASxD,MAAT,EAAiByD,GAAjB,EAAsBrC,MAAtB,EAA8B;AAC7C,SAAKsC,MAAL,GAAc1D,MAAd;AACA,SAAK2D,OAAL,GAAehH,kBAAkB,CAACyE,MAAM,CAAC9C,cAAR,CAAjC;AACA,SAAKI,WAAL,GAAmB+E,GAAnB;AACA,SAAKG,SAAL,GAAiBxC,MAAM,CAAC5C,gBAAxB;AACA,SAAKI,KAAL,GAAawC,MAAM,CAACxC,KAApB;AACA,SAAKrB,MAAL,GAAc6D,MAAM,CAAC7D,MAArB;AACA,SAAKyB,IAAL,GAAYoC,MAAM,CAACpC,IAAnB;AACA,SAAKD,IAAL,GAAYqC,MAAM,CAACrC,IAAnB;AACD,GATD;;AAWAyE,EAAAA,UAAU,CAAC1C,SAAX,CAAqB+C,QAArB,GAAgC,UAASC,KAAT,EAAgB;AAC9C,QAAIA,KAAK,GAAG,CAAR,IAAaA,KAAK,IAAI,KAAKpF,WAA/B,EAA4C,MAAM,IAAIkB,KAAJ,CAAU,0BAAV,CAAN;AAE5C,QAAIhD,EAAE,GAAG,IAAImH,QAAJ,CAAa,KAAKL,MAAlB,EAA0BI,KAAK,GAAG,KAAKF,SAAvC,EAAkD,KAAKA,SAAvD,CAAT;AACA,WAAO,KAAKD,OAAL,CAAa/G,EAAb,CAAP;AACD,GALD;;AAOAgG,EAAAA,OAAO,CAAC9B,SAAR,CAAkBkD,WAAlB,GAAgC,YAAW;AACzC,WAAOR,UAAP;AACD,GAFD;;AAIA9G,EAAAA,KAAK,CAACkG,OAAN,GAAgBA,OAAhB;AACAlG,EAAAA,KAAK,CAACuH,kBAAN,GAA2B,KAA3B;AACD,CAxVD,EAwVGC,MAAM,CAACC,OAxVV;AA0VA","sourcesContent":["/*\n  Modified from Uday Verma and Howard Butler's plasio\n  https://github.com/verma/plasio/\n  MIT License\n*/\n\n// laslaz.js - treat as compiled code\n/* eslint-disable */\n\n(function(scope) {\n  'use strict';\n\n  var pointFormatReaders = {\n    0: function(dv) {\n      return {\n        position: [dv.getInt32(0, true), dv.getInt32(4, true), dv.getInt32(8, true)],\n        intensity: dv.getUint16(12, true),\n        classification: dv.getUint8(15, true)\n      };\n    },\n    1: function(dv) {\n      return {\n        position: [dv.getInt32(0, true), dv.getInt32(4, true), dv.getInt32(8, true)],\n        intensity: dv.getUint16(12, true),\n        classification: dv.getUint8(15, true)\n      };\n    },\n    2: function(dv) {\n      return {\n        position: [dv.getInt32(0, true), dv.getInt32(4, true), dv.getInt32(8, true)],\n        intensity: dv.getUint16(12, true),\n        classification: dv.getUint8(15, true),\n        color: [dv.getUint16(20, true), dv.getUint16(22, true), dv.getUint16(24, true)]\n      };\n    },\n    3: function(dv) {\n      return {\n        position: [dv.getInt32(0, true), dv.getInt32(4, true), dv.getInt32(8, true)],\n        intensity: dv.getUint16(12, true),\n        classification: dv.getUint8(15, true),\n        color: [dv.getUint16(28, true), dv.getUint16(30, true), dv.getUint16(32, true)]\n      };\n    }\n  };\n\n  function readAs(buf, Type, offset, count) {\n    count = count === undefined || count === 0 ? 1 : count;\n    var sub = buf.slice(offset, offset + Type.BYTES_PER_ELEMENT * count);\n\n    var r = new Type(sub);\n    if (count === 1) return r[0];\n\n    var ret = [];\n    for (var i = 0; i < count; i++) {\n      ret.push(r[i]);\n    }\n\n    return ret;\n  }\n\n  function parseLASHeader(arraybuffer) {\n    var o = {};\n\n    o.pointsOffset = readAs(arraybuffer, Uint32Array, 32 * 3);\n    o.pointsFormatId = readAs(arraybuffer, Uint8Array, 32 * 3 + 8);\n    o.pointsStructSize = readAs(arraybuffer, Uint16Array, 32 * 3 + 8 + 1);\n    o.pointsCount = readAs(arraybuffer, Uint32Array, 32 * 3 + 11);\n\n    var start = 32 * 3 + 35;\n    o.scale = readAs(arraybuffer, Float64Array, start, 3);\n    start += 24; // 8*3\n    o.offset = readAs(arraybuffer, Float64Array, start, 3);\n    start += 24;\n\n    var bounds = readAs(arraybuffer, Float64Array, start, 6);\n    start += 48; // 8*6;\n    o.maxs = [bounds[0], bounds[2], bounds[4]];\n    o.mins = [bounds[1], bounds[3], bounds[5]];\n\n    return o;\n  }\n\n  var msgIndex = 0;\n  var waitHandlers = {};\n\n  // This method is scope-wide since the nacl module uses this fuction to notify\n  // us of events\n  scope.handleMessage = function(message_event) {\n    var msg = message_event.data;\n    var resolver = waitHandlers[msg.id];\n    delete waitHandlers[msg.id];\n\n    // call the callback in a separate context, make sure we've cleaned our\n    // state out before the callback is invoked since it may queue more doExchanges\n    setTimeout(function() {\n      if (msg.error) return resolver.reject(new Error(msg.message || 'Unknown Error'));\n\n      if (msg.hasOwnProperty('count') && msg.hasOwnProperty('hasMoreData')) {\n        return resolver.resolve({\n          buffer: msg.result,\n          count: msg.count,\n          hasMoreData: msg.hasMoreData\n        });\n      }\n\n      resolver.resolve(msg.result);\n    }, 0);\n  };\n\n  var doDataExchange = function(cmd, callback) {\n    cmd.id = msgIndex.toString();\n    msgIndex++;\n\n    var resolver = Promise.defer();\n    waitHandlers[cmd.id] = resolver;\n\n    nacl_module.postMessage(cmd);\n\n    return resolver.promise.cancellable();\n  };\n\n  // LAS Loader\n  // Loads uncompressed files\n  //\n  var LASLoader = function(arraybuffer) {\n    this.arraybuffer = arraybuffer;\n  };\n\n  LASLoader.prototype.open = function() {\n    // nothing needs to be done to open this file\n    //\n    this.readOffset = 0;\n    return new Promise(function(res, rej) {\n      setTimeout(res, 0);\n    });\n  };\n\n  LASLoader.prototype.getHeader = function() {\n    var o = this;\n\n    return new Promise(function(res, rej) {\n      setTimeout(function() {\n        o.header = parseLASHeader(o.arraybuffer);\n        res(o.header);\n      }, 0);\n    });\n  };\n\n  LASLoader.prototype.readData = function(count, offset, skip) {\n    var o = this;\n\n    return new Promise(function(res, rej) {\n      setTimeout(function() {\n        if (!o.header)\n          return rej(new Error('Cannot start reading data till a header request is issued'));\n\n        var start;\n        if (skip <= 1) {\n          count = Math.min(count, o.header.pointsCount - o.readOffset);\n          start = o.header.pointsOffset + o.readOffset * o.header.pointsStructSize;\n          var end = start + count * o.header.pointsStructSize;\n          res({\n            buffer: o.arraybuffer.slice(start, end),\n            count: count,\n            hasMoreData: o.readOffset + count < o.header.pointsCount\n          });\n          o.readOffset += count;\n        } else {\n          var pointsToRead = Math.min(count * skip, o.header.pointsCount - o.readOffset);\n          var bufferSize = Math.ceil(pointsToRead / skip);\n          var pointsRead = 0;\n\n          var buf = new Uint8Array(bufferSize * o.header.pointsStructSize);\n          for (var i = 0; i < pointsToRead; i++) {\n            if (i % skip === 0) {\n              start = o.header.pointsOffset + o.readOffset * o.header.pointsStructSize;\n              var src = new Uint8Array(o.arraybuffer, start, o.header.pointsStructSize);\n\n              buf.set(src, pointsRead * o.header.pointsStructSize);\n              pointsRead++;\n            }\n\n            o.readOffset++;\n          }\n\n          res({\n            buffer: buf.buffer,\n            count: pointsRead,\n            hasMoreData: o.readOffset < o.header.pointsCount\n          });\n        }\n      }, 0);\n    });\n  };\n\n  LASLoader.prototype.close = function() {\n    var o = this;\n    return new Promise(function(res, rej) {\n      o.arraybuffer = null;\n      setTimeout(res, 0);\n    });\n  };\n\n  // LAZ Loader\n  // Uses NaCL module to load LAZ files\n  //\n  var LAZLoader = function(arraybuffer) {\n    this.arraybuffer = arraybuffer;\n    this.ww = new Worker(`workers/laz-loader-worker.js`);\n\n    this.nextCB = null;\n    var o = this;\n\n    this.ww.onmessage = function(e) {\n      if (o.nextCB !== null) {\n        o.nextCB(e.data);\n        o.nextCB = null;\n      }\n    };\n\n    this.dorr = function(req, cb) {\n      o.nextCB = cb;\n      o.ww.postMessage(req);\n    };\n  };\n\n  LAZLoader.prototype.open = function() {\n    // nothing needs to be done to open this file\n    //\n    var o = this;\n    return new Promise(function(res, rej) {\n      o.dorr({type: 'open', arraybuffer: o.arraybuffer}, function(r) {\n        if (r.status !== 1) return rej(new Error('Failed to open file'));\n\n        res(true);\n      });\n    });\n  };\n\n  LAZLoader.prototype.getHeader = function() {\n    var o = this;\n\n    return new Promise(function(res, rej) {\n      o.dorr({type: 'header'}, function(r) {\n        if (r.status !== 1) return rej(new Error('Failed to get header'));\n\n        res(r.header);\n      });\n    });\n  };\n\n  LAZLoader.prototype.readData = function(count, offset, skip) {\n    var o = this;\n\n    return new Promise(function(res, rej) {\n      o.dorr({type: 'read', count: count, offset: offset, skip: skip}, function(r) {\n        if (r.status !== 1) return rej(new Error('Failed to read data'));\n        res({\n          buffer: r.buffer,\n          count: r.count,\n          hasMoreData: r.hasMoreData\n        });\n      });\n    });\n  };\n\n  LAZLoader.prototype.close = function() {\n    var o = this;\n\n    return new Promise(function(res, rej) {\n      o.dorr({type: 'close'}, function(r) {\n        if (r.status !== 1) return rej(new Error('Failed to close file'));\n\n        res(true);\n      });\n    });\n  };\n\n  // A single consistent interface for loading LAS/LAZ files\n  var LASFile = function(arraybuffer) {\n    this.arraybuffer = arraybuffer;\n\n    this.determineVersion();\n    if (this.version > 13) throw new Error('Only file versions <= 1.3 are supported at this time');\n\n    this.determineFormat();\n    if (pointFormatReaders[this.formatId] === undefined)\n      throw new Error('The point format ID is not supported');\n\n    this.loader = this.isCompressed\n      ? new LAZLoader(this.arraybuffer)\n      : new LASLoader(this.arraybuffer);\n  };\n\n  LASFile.prototype.determineFormat = function() {\n    var formatId = readAs(this.arraybuffer, Uint8Array, 32 * 3 + 8);\n    var bit_7 = (formatId & 0x80) >> 7;\n    var bit_6 = (formatId & 0x40) >> 6;\n\n    if (bit_7 === 1 && bit_6 === 1) throw new Error('Old style compression not supported');\n\n    this.formatId = formatId & 0x3f;\n    this.isCompressed = bit_7 === 1 || bit_6 === 1;\n  };\n\n  LASFile.prototype.determineVersion = function() {\n    var ver = new Int8Array(this.arraybuffer, 24, 2);\n    this.version = ver[0] * 10 + ver[1];\n    this.versionAsString = ver[0] + '.' + ver[1];\n  };\n\n  LASFile.prototype.open = function() {\n    return this.loader.open();\n  };\n\n  LASFile.prototype.getHeader = function() {\n    return this.loader.getHeader();\n  };\n\n  LASFile.prototype.readData = function(count, start, skip) {\n    return this.loader.readData(count, start, skip);\n  };\n\n  LASFile.prototype.close = function() {\n    return this.loader.close();\n  };\n\n  // Decodes LAS records into points\n  //\n  var LASDecoder = function(buffer, len, header) {\n    this.arrayb = buffer;\n    this.decoder = pointFormatReaders[header.pointsFormatId];\n    this.pointsCount = len;\n    this.pointSize = header.pointsStructSize;\n    this.scale = header.scale;\n    this.offset = header.offset;\n    this.mins = header.mins;\n    this.maxs = header.maxs;\n  };\n\n  LASDecoder.prototype.getPoint = function(index) {\n    if (index < 0 || index >= this.pointsCount) throw new Error('Point index out of range');\n\n    var dv = new DataView(this.arrayb, index * this.pointSize, this.pointSize);\n    return this.decoder(dv);\n  };\n\n  LASFile.prototype.getUnpacker = function() {\n    return LASDecoder;\n  };\n\n  scope.LASFile = LASFile;\n  scope.LASModuleWasLoaded = false;\n})(module.exports);\n\n/* eslint no-use-before-define: 2 */\n"],"file":"laslaz.js"}