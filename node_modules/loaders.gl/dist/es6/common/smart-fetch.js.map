{"version":3,"sources":["../../../src/common/smart-fetch.js"],"names":["path","smartFetch","url","loaders","options","fetch","then","response","text","smartParse","loader","getLoader","parseText","Error","name","extension","extname","length","substr","toLowerCase","testText"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,MAAjB;AAEA,OAAO,SAASC,UAAT,CAAoBC,GAApB,EAAyBC,OAAzB,EAAkCC,OAAlC,EAA2C;AAChD;AACA,SAAOC,KAAK,CAACH,GAAD,CAAL,CACJI,IADI,CACCC,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EADb,EAEJF,IAFI,CAECE,IAAI,IAAIC,UAAU,CAACD,IAAD,EAAON,GAAP,CAFnB,CAAP;AAGD,C,CAED;;AACA,OAAO,SAASO,UAAT,CAAoBD,IAApB,EAA0BN,GAA1B,EAA+BC,OAA/B,EAAwCC,OAAxC,EAAiD;AACtD,QAAMM,MAAM,GAAGC,SAAS,CAACT,GAAD,EAAMM,IAAN,EAAYL,OAAZ,CAAxB;;AACA,MAAI,CAACO,MAAM,CAACE,SAAZ,EAAuB;AACrB,UAAM,IAAIC,KAAJ,CAAW,GAAEH,MAAM,CAACI,IAAK,4BAAzB,CAAN;AACD;;AAED,SAAOJ,MAAM,CAACE,SAAP,CAAiBJ,IAAjB,EAAuBJ,OAAvB,CAAP;AACD,C,CAED;;AACA,SAASO,SAAT,CAAmBT,GAAnB,EAAwBM,IAAxB,EAA8BL,OAA9B,EAAuC;AACrC;AACA,MAAIY,SAAS,GAAGf,IAAI,CAACgB,OAAL,CAAad,GAAb,KAAqBA,GAArC;;AACA,MAAIa,SAAS,CAACE,MAAV,IAAoBF,SAAS,CAAC,CAAD,CAAT,KAAiB,GAAzC,EAA8C;AAC5CA,IAAAA,SAAS,GAAGA,SAAS,CAACG,MAAV,CAAiB,CAAjB,EAAoBC,WAApB,EAAZ;AACD;;AAED,OAAK,MAAMT,MAAX,IAAqBP,OAArB,EAA8B;AAC5B,QAAIO,MAAM,CAACK,SAAP,KAAqBA,SAAzB,EAAoC;AAClC,aAAOL,MAAP;AACD;AACF;;AAED,OAAK,MAAMA,MAAX,IAAqBP,OAArB,EAA8B;AAC5B,QAAIO,MAAM,CAACI,IAAP,CAAYK,WAAZ,KAA4BJ,SAAhC,EAA2C;AACzC,aAAOL,MAAP;AACD;AACF;;AAED,OAAK,MAAMA,MAAX,IAAqBP,OAArB,EAA8B;AAC5B,QAAIO,MAAM,CAACU,QAAP,IAAmBV,MAAM,CAACU,QAAP,CAAgBZ,IAAhB,CAAvB,EAA8C;AAC5C,aAAOE,MAAP;AACD;AACF;;AAED,SAAO,IAAP;AACD","sourcesContent":["import path from 'path';\n\nexport function smartFetch(url, loaders, options) {\n  /* global fetch */\n  return fetch(url)\n    .then(response => response.text())\n    .then(text => smartParse(text, url));\n}\n\n// Find a loader that works for extension/text\nexport function smartParse(text, url, loaders, options) {\n  const loader = getLoader(url, text, loaders);\n  if (!loader.parseText) {\n    throw new Error(`${loader.name} loader cannot handle text`);\n  }\n\n  return loader.parseText(text, options);\n}\n\n// Search the loaders array argument for a loader that matches extension or text\nfunction getLoader(url, text, loaders) {\n  // Get extension without\n  let extension = path.extname(url) || url;\n  if (extension.length && extension[0] === '.') {\n    extension = extension.substr(1).toLowerCase();\n  }\n\n  for (const loader of loaders) {\n    if (loader.extension === extension) {\n      return loader;\n    }\n  }\n\n  for (const loader of loaders) {\n    if (loader.name.toLowerCase === extension) {\n      return loader;\n    }\n  }\n\n  for (const loader of loaders) {\n    if (loader.testText && loader.testText(text)) {\n      return loader;\n    }\n  }\n\n  return null;\n}\n"],"file":"smart-fetch.js"}