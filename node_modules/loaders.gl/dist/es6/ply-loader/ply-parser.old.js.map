{"version":3,"sources":["../../../src/ply-loader/ply-parser.old.js"],"names":["isLittleEndian","Uint32Array","Uint8Array","buffer","PARSER_STATE","BEGIN","FORMAT","HEADER","BODY","DONE","ERROR","PLY_FORMAT","ASCII","BINARY_LITTLE_ENDIAN","BINARY_BIG_ENDIAN","UNKNOWN","PLY_TYPES","INT","FLOAT","LIST","LIST_INT","LIST_FLOAT","PLY_TYPENAMES","char","Int8Array","int8","uchar","uint8","short","Int16Array","int16","ushort","Uint16Array","uint16","int","Int32Array","int32","uint","uint32","float","Float32Array","float32","double","Float64Array","float64","SYSTEM_ENDIAN","PLYProperty","constructor","name","data","type","size0","size1","PLYElement","count","properties","data_buffer","float_view","double_view","TRAIL_EOL","Buffer","PLYParser","onsuccess","onerror","state","format","elements","offset","buffers","current_element","current_index","current_line","current_property","current_list_property","last_line","getline","max_len","ptr","cbuf","n","prefix","length","push","slice","splice","join","toString","shift","console","log","getchar","v","getint","len","i","Number","NaN","r","j","getfloat","t","clearBuffers","raiseError","message","Error","createResult","result","element","props","prop","processBinary","c","idx","p","vi","isNaN","vf","lst","Array","processAscii","l","toks","split","c_tok","parseInt","parseFloat","processProperty","sz","t0","t1","typecons","processToken","ondata","onend","parse"],"mappings":"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","sourcesContent":["/*\n  Modified from Mikola Lysenko's parse-ply\n  MIT License\n*/\n/* eslint-disable */\nconst isLittleEndian = new Uint32Array(new Uint8Array([1, 2, 3, 4]).buffer)[0] === 0x04030201;\n\nconst PARSER_STATE = {\n  BEGIN: 0,\n  FORMAT: 1,\n  HEADER: 2,\n  BODY: 4,\n  DONE: 5,\n  ERROR: -1\n};\n\nconst PLY_FORMAT = {\n  ASCII: 0,\n  BINARY_LITTLE_ENDIAN: 1,\n  BINARY_BIG_ENDIAN: 2,\n  UNKNOWN: -1\n};\n\nconst PLY_TYPES = {\n  INT: 0,\n  FLOAT: 1,\n  LIST: 2,\n  LIST_INT: 2,\n  LIST_FLOAT: 3\n};\n\nconst PLY_TYPENAMES = {\n  char: [PLY_TYPES.INT, 1, Int8Array],\n  int8: [PLY_TYPES.INT, 1, Int8Array],\n  uchar: [PLY_TYPES.INT, 1, Uint8Array],\n  uint8: [PLY_TYPES.INT, 1, Uint8Array],\n  short: [PLY_TYPES.INT, 2, Int16Array],\n  int16: [PLY_TYPES.INT, 2, Int16Array],\n  ushort: [PLY_TYPES.INT, 2, Uint16Array],\n  uint16: [PLY_TYPES.INT, 2, Uint16Array],\n  int: [PLY_TYPES.INT, 4, Int32Array],\n  int32: [PLY_TYPES.INT, 4, Int32Array],\n  uint: [PLY_TYPES.INT, 4, Uint32Array],\n  uint32: [PLY_TYPES.INT, 4, Uint32Array],\n  float: [PLY_TYPES.FLOAT, 4, Float32Array],\n  float32: [PLY_TYPES.FLOAT, 4, Float32Array],\n  double: [PLY_TYPES.FLOAT, 8, Float64Array],\n  float64: [PLY_TYPES.FLOAT, 8, Float64Array]\n};\n\nconst SYSTEM_ENDIAN = isLittleEndian\n  ? PLY_FORMAT.BINARY_LITTLE_ENDIAN\n  : PLY_FORMAT.BINARY_BIG_ENDIAN;\n\nclass PLYProperty {\n  constructor(name, data, type, size0, size1) {\n    this.name = name;\n    this.data = data;\n    this.type = type;\n    this.size0 = size0;\n    this.size1 = size1;\n  }\n}\n\nclass PLYElement {\n  constructor(name, count) {\n    this.name = name;\n    this.count = count;\n    this.properties = [];\n  }\n}\n\nconst data_buffer = new Uint8Array(8);\nconst float_view = new Float32Array(data_buffer.buffer);\nconst double_view = new Float64Array(data_buffer.buffer);\n\nconst TRAIL_EOL = new Buffer(1);\nTRAIL_EOL[0] = 10;\n\nexport default class PLYParser {\n  constructor() {\n    this.onsuccess = () => {};\n    this.onerror = () => {};\n    this.state = PARSER_STATE.BEGIN;\n    this.format = PLY_FORMAT.UNKNOWN;\n    this.elements = [];\n    this.offset = 0;\n    this.buffers = [];\n    this.current_element = 0;\n    this.current_index = 0;\n    this.current_line = 0;\n    this.current_property = 0;\n    this.current_list_property = -1;\n    this.last_line = '';\n  }\n\n  getline(max_len) {\n    var ptr = this.offset;\n    var cbuf = 0;\n    var n = 0;\n    var prefix = null;\n    while (n < max_len && cbuf < this.buffers.length) {\n      if (this.buffers[cbuf][ptr] === 10) {\n        this.current_line++;\n        if (cbuf > 0) {\n          prefix.push(this.buffers[cbuf].slice(0, ptr));\n          this.offset = ptr + 1;\n          if (this.offset >= this.buffers[cbuf].length) {\n            this.offset = 0;\n            this.buffers.splice(0, cbuf + 1);\n          } else {\n            this.buffers.splice(0, cbuf);\n          }\n          this.last_line = prefix.join('');\n          return this.last_line;\n        } else {\n          this.last_line = this.buffers[0].slice(this.offset, ptr).toString();\n          this.offset = ptr + 1;\n          if (this.offset >= this.buffers[cbuf].length) {\n            this.offset = 0;\n            this.buffers.shift();\n          }\n          return this.last_line;\n        }\n      }\n      if (++ptr >= this.buffers[cbuf].length) {\n        if (cbuf === 0) {\n          prefix = [this.buffers[0].slice(this.offset)];\n        }\n        ++n;\n        ++cbuf;\n        ptr = 0;\n      }\n    }\n    console.log(this.offset);\n    if (n >= max_len) {\n      return '!';\n    }\n    return null;\n  }\n\n  getchar() {\n    if (this.buffers.length > 0) {\n      var v = this.buffers[0][this.offset];\n      this.offset++;\n      if (this.offset > this.buffers[0].length) {\n        this.offset = 0;\n        this.buffers.shift();\n      }\n      return v;\n    }\n    return -1;\n  }\n\n  getint(len) {\n    for (var i = 0; i < len; ++i) {\n      var v = this.getchar();\n      if (v < 0) {\n        return Number.NaN;\n      }\n      data_buffer[i] = v;\n    }\n    var r = 0;\n    if (this.format === PLY_FORMAT.BINARY_LITTLE_ENDIAN) {\n      for (var j = 0; j < len; ++j) {\n        r += data_buffer[j] << (8 * j);\n      }\n    } else {\n      for (var j = 0; j < len; ++j) {\n        r += data_buffer[len - j - 1] << (8 * j);\n      }\n    }\n    return r;\n  }\n\n  getfloat(len) {\n    for (var i = 0; i < len; ++i) {\n      var v = this.getchar();\n      if (v < 0) {\n        return Number.NaN;\n      }\n      data_buffer[i] = v;\n    }\n    if (this.format !== SYSTEM_ENDIAN) {\n      for (var i = 0; i < len; ++i) {\n        var t = data_buffer[i];\n        data_buffer[i] = data_buffer[len - i - 1];\n        data_buffer[len - i - 1] = t;\n      }\n    }\n    if (len === 4) {\n      return float_view[0];\n    } else {\n      return double_view[0];\n    }\n  }\n\n  clearBuffers() {\n    this.offset = 0;\n    this.buffers = [];\n  }\n\n  raiseError(message) {\n    if (this.state !== PARSER_STATE.ERROR) {\n      this.state = PARSER_STATE.ERROR;\n      if (this.current_line > 0) {\n        this.onerror(\n          new Error(\n            'Error parsing PLY: ' +\n              message +\n              ' on line ' +\n              this.current_line +\n              \"\\n\\t'\" +\n              this.last_line +\n              \"'\"\n          )\n        );\n      } else {\n        this.onerror(new Error('Error parsing PLY: ' + message));\n      }\n      this.clearBuffers();\n    }\n  }\n\n  createResult() {\n    var result = {};\n    for (var i = 0; i < this.elements.length; ++i) {\n      var element = this.elements[i];\n      var props = {};\n      for (var j = 0; j < element.properties.length; ++j) {\n        var prop = element.properties[j];\n        props[prop.name] = prop.data;\n      }\n      result[element.name] = props;\n    }\n    return result;\n  }\n\n  processBinary() {\n    while (this.current_element < this.elements.length) {\n      var c = this.elements[this.current_element];\n      var props = c.properties;\n      while (this.current_index < c.count) {\n        var idx = this.current_index;\n        while (this.current_property < props.length) {\n          var p = props[this.current_property++];\n          switch (p.type) {\n            case PLY_TYPES.INT:\n              var vi = this.getint(p.size0);\n              if (isNaN(vi)) {\n                this.raiseError('Invalid integer value');\n                return false;\n              }\n              p.data[idx] = vi;\n              break;\n\n            case PLY_TYPES.FLOAT:\n              var vf = this.getfloat(p.size0);\n              if (isNaN(vf)) {\n                this.raiseError('Invalid float value');\n                return false;\n              }\n              p.data[idx] = vf;\n              break;\n\n            case PLY_TYPES.LIST_INT:\n            case PLY_TYPES.LIST_FLOAT:\n              var lst;\n              if (this.current_list_property < 0) {\n                var vi = this.getint(p.size0);\n                if (isNaN(vi)) {\n                  this.raiseError('Invalid list length');\n                  return false;\n                }\n                lst = new Array(vi);\n                p.data[idx] = lst;\n                this.current_list_property = 0;\n              } else {\n                lst = p.data[idx];\n              }\n              while (this.current_list_property < lst.length) {\n                var v;\n                if (p.type === PLY_TYPES.LIST_INT) {\n                  v = this.getint(p.size1);\n                } else {\n                  v = this.getfloat(p.size1);\n                }\n                if (isNaN(v)) {\n                  this.raiseError('Invalid value in list');\n                  return false;\n                }\n                lst[this.current_list_property++] = v;\n              }\n              this.current_list_property = -1;\n              break;\n\n            default:\n              this.raiseError('Uninitialized property type (this should never happen)');\n              return false;\n          }\n        }\n\n        this.current_property = 0;\n        this.current_index += 1;\n      }\n      this.current_index = 0;\n      this.current_element++;\n    }\n    this.state = PARSER_STATE.DONE;\n    return true;\n  }\n\n  processAscii() {\n    while (this.current_element < this.elements.length) {\n      var c = this.elements[this.current_element];\n      var props = c.properties;\n      while (this.current_index < c.count) {\n        var l = this.getline(1 << 20);\n        if (!l) {\n          return false;\n        }\n        var idx = this.current_index;\n        var toks = l.split(' ');\n        var c_tok = 0;\n        for (var i = 0; i < props.length; ++i) {\n          if (c_tok >= toks.length) {\n            this.raiseError('Not enough values for element');\n            return false;\n          }\n          var p = props[i];\n          switch (p.type) {\n            case PLY_TYPES.INT:\n              var vi = parseInt(toks[c_tok++], 10);\n              if (isNaN(vi)) {\n                this.raiseError('Invalid integer value');\n                return false;\n              }\n              p.data[idx] = vi;\n              break;\n\n            case PLY_TYPES.FLOAT:\n              var vf = parseFloat(toks[c_tok++]);\n              if (isNaN(vf)) {\n                this.raiseError('Invalid float value');\n                return false;\n              }\n              p.data[idx] = vf;\n              break;\n\n            case PLY_TYPES.LIST_INT:\n            case PLY_TYPES.LIST_FLOAT:\n              var vi = parseInt(toks[c_tok++]);\n              if (isNaN(vi) || vi < 0) {\n                this.raiseError('Invalid list length');\n                return false;\n              }\n              if (vi + c_tok > toks.length) {\n                this.raiseError('List length too long');\n                return false;\n              }\n              var result = new Array(vi);\n              p.data[idx] = result;\n              if (p.type === PLY_TYPES.LIST_INT) {\n                for (var j = 0; j < vi; ++j) {\n                  result[j] = parseInt(toks[c_tok++], 10);\n                  if (isNaN(result[j])) {\n                    this.raiseError('Invalid integer in list');\n                    return false;\n                  }\n                }\n              } else {\n                for (var j = 0; j < vi; ++j) {\n                  result[j] = parseFloat(toks[c_tok++]);\n                  if (isNaN(result[j])) {\n                    this.raiseError('Invalid float in list');\n                    return false;\n                  }\n                }\n              }\n              break;\n\n            default:\n              this.raiseError('Uninitialized property type (this should never happen)');\n              return false;\n          }\n        }\n        this.current_index += 1;\n      }\n      this.current_index = 0;\n      this.current_element++;\n    }\n    this.state = PARSER_STATE.DONE;\n    return true;\n  }\n\n  processProperty(name, type) {\n    var sz = this.elements[this.elements.length - 1].count;\n    if (type[0] === 'list') {\n      if (type.length !== 3) {\n        this.raiseError('Invalid list datatype');\n        return null;\n      }\n      var t0 = PLY_TYPENAMES[type[1]];\n      var t1 = PLY_TYPENAMES[type[2]];\n      if (!t0 || t0[0] !== PLY_TYPES.INT) {\n        this.raiseError('List length must be an integer');\n        return null;\n      }\n      if (!t1) {\n        this.raiseError('Invalid type for list values');\n        return null;\n      }\n      return new PLYProperty(name, new Array(sz), t1[0] + PLY_TYPES.LIST, t0[1], t1[1]);\n    }\n    var t = PLY_TYPENAMES[type[0]];\n    if (!t) {\n      this.raiseError('Invalid property datatype');\n      return null;\n    }\n    var typecons = t[2];\n    return new PLYProperty(name, new typecons(sz), t[0], t[1], 0);\n  }\n\n  processToken() {\n    switch (this.state) {\n      case PARSER_STATE.BEGIN:\n        var l = this.getline(4);\n        if (!l) {\n          return false;\n        }\n        if (l === 'ply') {\n          this.state = PARSER_STATE.FORMAT;\n          return true;\n        } else {\n          this.raiseError('Missing/invalid PLY magic number');\n          return false;\n        }\n        break;\n\n      case PARSER_STATE.FORMAT:\n        var l = this.getline(64);\n        if (!l) {\n          return false;\n        }\n        var toks = l.split(' ');\n        if (toks.length > 0 && toks[0] === 'comment') {\n          return true;\n        }\n        if (toks.length !== 3 || toks[0] !== 'format' || toks[2] !== '1.0') {\n          this.raiseError('Missing/invalid format specifier');\n          return false;\n        }\n        switch (toks[1]) {\n          case 'ascii':\n            this.format = PLY_FORMAT.ASCII;\n            break;\n\n          case 'binary_little_endian':\n            this.format = PLY_FORMAT.BINARY_LITTLE_ENDIAN;\n            break;\n\n          case 'binary_big_endian':\n            this.format = PLY_FORMAT.BINARY_BIG_ENDIAN;\n            break;\n\n          default:\n            this.raiseError('Invalid format');\n            return false;\n            break;\n        }\n        this.state = PARSER_STATE.HEADER;\n        return true;\n        break;\n\n      case PARSER_STATE.HEADER:\n        var l = this.getline(4096);\n        if (!l) {\n          return false;\n        }\n        var toks = l.split(' ');\n        switch (toks[0]) {\n          case 'element':\n            if (toks.length !== 3) {\n              this.raiseError('Invalid element description');\n              return false;\n            }\n            var count = parseInt(toks[2], 10);\n            if (isNaN(count) || count < 0) {\n              this.raiseError('Invalid element count');\n              return false;\n            }\n            this.elements.push(new PLYElement(toks[1], count));\n            return true;\n            break;\n\n          case 'property':\n            if (this.elements.length === 0) {\n              this.raiseError('Got a property without an element');\n              return false;\n            }\n            if (toks.length < 3) {\n              this.raiseError('Invalid property description');\n              return false;\n            }\n            var prop = this.processProperty(toks[toks.length - 1], toks.slice(1, toks.length - 1));\n            if (!prop) {\n              return false;\n            }\n            this.elements[this.elements.length - 1].properties.push(prop);\n            return true;\n            break;\n\n          case 'end_header':\n            this.current_index = 0;\n            this.current_element = 0;\n            this.state = PARSER_STATE.BODY;\n            if (this.format !== PLY_FORMAT.ASCII) {\n              this.current_line = -1;\n            }\n            return true;\n            break;\n\n          case 'comment':\n            return true;\n            break;\n\n          default:\n            this.raiseError('Unexpeceted token in header');\n            return false;\n        }\n        break;\n\n      case PARSER_STATE.BODY:\n        switch (this.format) {\n          case PLY_FORMAT.ASCII:\n            return this.processAscii();\n          case PLY_FORMAT.BINARY_LITTLE_ENDIAN:\n          case PLY_FORMAT.BINARY_BIG_ENDIAN:\n            return this.processBinary();\n          default:\n            this.raiseError('Invalid format, this should not happen');\n            return false;\n        }\n        break;\n\n      case PARSER_STATE.DONE:\n        this.clearBuffers();\n        return false;\n        break;\n\n      case PARSER_STATE.ERROR:\n        this.clearBuffers();\n        return false;\n        break;\n\n      default:\n        this.raiseError('Parser state corrupted');\n        return false;\n    }\n    return false;\n  }\n\n  ondata(data) {\n    if (this.state === PARSER_STATE.ERROR) {\n      return;\n    }\n    if (data instanceof Buffer) {\n      this.buffers.push(data);\n    } else {\n      this.buffers.push(new Buffer(data));\n    }\n    while (this.processToken()) {}\n  }\n\n  onend() {\n    this.ondata(TRAIL_EOL);\n    this.clearBuffers();\n    if (this.state === PARSER_STATE.DONE) {\n      this.onsuccess(this.createResult());\n    } else if (this.state !== PARSER_STATE.ERROR) {\n      this.raiseError('Unexpected EOF while parsing PLY file');\n    }\n  }\n\n  parse(buffer) {\n    this.ondata(buffer);\n    this.onend();\n  }\n}\n"],"file":"ply-parser.old.js"}